--- php-4.4.4/Zend/zend_ini.c.cve-2006-4625.droplet	2006-10-17 12:17:09.000000000 -0600
+++ php-4.4.4/Zend/zend_ini.c	2006-10-17 12:21:01.000000000 -0600
@@ -256,8 +256,8 @@ ZEND_API int zend_restore_ini_entry(char
 	zend_ini_entry *ini_entry;
 	TSRMLS_FETCH();
 
-	if (zend_hash_find(EG(ini_directives), name, name_length, (void **) &ini_entry)==FAILURE) {
-		return FAILURE;
+	if (zend_hash_find(EG(ini_directives), name, name_length, (void **) &ini_entry)==FAILURE ||
+	    (stage == ZEND_INI_STAGE_RUNTIME && (ini_entry->modifyable & ZEND_INI_USER) == 0)) {		return FAILURE;
 	}
 
 	zend_restore_ini_entry_cb(ini_entry, stage TSRMLS_CC);
