--- gzip-1.2.4a/zgrep.in.can-2005-0758	1993-06-23 01:51:32.000000000 -0600
+++ gzip-1.2.4a/zgrep.in	2006-01-30 10:53:58.008807301 -0700
@@ -6,7 +6,7 @@
 
 PATH="BINDIR:$PATH"; export PATH
 
-prog=`echo $0 | sed 's|.*/||'`
+prog=`echo "$0" | sed 's|.*/||'`
 case "$prog" in
 	*egrep)	grep=${EGREP-egrep}	;;
 	*fgrep)	grep=${FGREP-fgrep}	;;
@@ -53,13 +53,17 @@
 res=0
 for i do
   if test $list -eq 1; then
-    gzip -cdfq "$i" | $grep $opt "$pat" > /dev/null && echo $i
+    gzip -cdfq "$i" | $grep $opt "$pat" > /dev/null && printf "%s\n" "$i"
     r=$?
   elif test $# -eq 1 -o $silent -eq 1; then
     gzip -cdfq "$i" | $grep $opt "$pat"
     r=$?
   else
-    gzip -cdfq "$i" | $grep $opt "$pat" | sed "s|^|${i}:|"
+    j=${i//\\/\\\\}
+    j=${j//|/\\|}
+    j=${j//&/\\&}
+    j=`printf "%s" "$j" | tr '\n' ' '`
+    gzip -cdfq "$i" | $grep $opt "$pat" | sed "s|^|${j}:|"
     r=$?
   fi
   test "$r" -ne 0 && res="$r"
