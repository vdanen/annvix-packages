--- src/lib-storage/index/mbox/mbox-storage.c.orig	2007-01-03 16:19:44.000000000 -0700
+++ src/lib-storage/index/mbox/mbox-storage.c	2007-07-17 20:03:49.222918500 -0600
@@ -718,6 +718,11 @@ mbox_mailbox_open(struct mail_storage *_
 
 	mail_storage_clear_error(_storage);
 
+	if (!mbox_is_valid_existing_name(_storage, name)) {
+		mail_storage_set_error(_storage, "Invalid mailbox name");
+		return NULL;
+	}
+
 	if (input != NULL)
 		return mbox_mailbox_open_stream(storage, name, input, flags);
 
@@ -728,11 +733,6 @@ mbox_mailbox_open(struct mail_storage *_
 		return mbox_open(storage, "INBOX", flags);
 	}
 
-	if (!mbox_is_valid_existing_name(_storage, name)) {
-		mail_storage_set_error(_storage, "Invalid mailbox name");
-		return NULL;
-	}
-
 	path = mbox_get_path(istorage, name);
 	if (stat(path, &st) == 0) {
 		if (S_ISDIR(st.st_mode)) {
