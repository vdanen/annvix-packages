Index: gd_png.c
===================================================================
RCS file: /repository/gd/libgd/gd_png.c,v
retrieving revision 1.21.2.1
diff -u -p -r1.21.2.1 gd_png.c
--- gd_png.c	1 Apr 2007 20:41:01 -0000	1.21.2.1
+++ gd_png.c	16 May 2007 19:06:11 -0000
@@ -81,7 +81,11 @@ gdPngErrorHandler (png_structp png_ptr, 
 static void
 gdPngReadData (png_structp png_ptr, png_bytep data, png_size_t length)
 {
-  gdGetBuf (data, length, (gdIOCtx *) png_get_io_ptr (png_ptr));
+  int check;
+  check = gdGetBuf (data, length, (gdIOCtx *) png_get_io_ptr (png_ptr));
+  if (check != length) {
+    png_error(png_ptr, "Read Error: truncated data");
+  }
 }
 
 static void
