--- kernel-2.4.22/lib/Makefile.propolice	2003-12-29 17:08:39.000000000 -0700
+++ kernel-2.4.22/lib/Makefile	2003-12-29 17:08:39.000000000 -0700
@@ -12,7 +12,7 @@
 	       rbtree.o crc32.o firmware_class.o
 
 obj-y := errno.o ctype.o string.o vsprintf.o brlock.o cmdline.o \
-	 bust_spinlocks.o rbtree.o dump_stack.o
+	 bust_spinlocks.o rbtree.o dump_stack.o propolice.o
 
 obj-$(CONFIG_RWSEM_GENERIC_SPINLOCK) += rwsem-spinlock.o
 obj-$(CONFIG_RWSEM_XCHGADD_ALGORITHM) += rwsem.o
--- /dev/null	2003-10-20 05:23:49.000000000 -0600
+++ kernel-2.4.22/lib/propolice.c	2003-12-29 17:10:24.000000000 -0700
@@ -0,0 +1,13 @@
+/*
+ *   linux/lib/errno.c
+ *
+ *
+ */
+ 
+int __guard = '\0\0\n\777';
+
+void __stack_smash_handler (int damaged, char func[])
+{
+  static char *message = "propolice detects %x at function %s.\n";
+  panic (message, damaged, func);
+}
--- kernel-2.4.22/kernel/ksyms.c.propolice	2003-12-29 17:11:36.000000000 -0700
+++ kernel-2.4.22/kernel/ksyms.c	2003-12-29 17:11:36.000000000 -0700
@@ -548,6 +548,9 @@
 EXPORT_SYMBOL(seq_release);
 EXPORT_SYMBOL(seq_read);
 EXPORT_SYMBOL(seq_lseek);
+/* Propolice */
+EXPORT_SYMBOL_NOVERS(__guard);
+EXPORT_SYMBOL_NOVERS(__stack_smash_handler);
 
 /* Program loader interfaces */
 EXPORT_SYMBOL(setup_arg_pages);
--- kernel-2.4.22/include/linux/kernel.h.propolice	2003-12-29 17:12:52.000000000 -0700
+++ kernel-2.4.22/include/linux/kernel.h	2003-12-29 17:12:52.000000000 -0700
@@ -77,6 +77,8 @@
 	__attribute__ ((format (printf, 3, 4)));
 extern int vsnprintf(char *buf, size_t size, const char *fmt, va_list args)
 	__attribute__ ((format (printf, 3, 0)));
+extern int __guard;
+extern void __stack_smash_handler(int, char []);
 
 extern int sscanf(const char *, const char *, ...)
 	__attribute__ ((format (scanf,2,3)));
