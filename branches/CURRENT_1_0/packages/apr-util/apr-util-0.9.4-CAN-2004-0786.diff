diff -Naur apr-util-0.9.4/test/testuri.c apr-util-0.9.4.oden/test/testuri.c
--- apr-util-0.9.4/test/testuri.c	2004-09-15 18:33:38.790855728 +0200
+++ apr-util-0.9.4.oden/test/testuri.c	2004-09-15 18:32:56.381302960 +0200
@@ -36,6 +36,10 @@
 
 struct aup_test aup_tests[] =
 {
+    { "http://[/::1]/index.html", APR_EGENERAL },
+    { "http://[", APR_EGENERAL },
+    { "http://[?::1]/index.html", APR_EGENERAL },
+
     {
         "http://127.0.0.1:9999/asdf.html",
         0, "http", "127.0.0.1:9999", NULL, NULL, "127.0.0.1", "9999", "/asdf.html", NULL, NULL, 9999
diff -Naur apr-util-0.9.4/uri/apr_uri.c apr-util-0.9.4.oden/uri/apr_uri.c
--- apr-util-0.9.4/uri/apr_uri.c	2004-09-15 18:33:38.792855424 +0200
+++ apr-util-0.9.4.oden/uri/apr_uri.c	2004-09-15 18:33:18.748902568 +0200
@@ -307,11 +307,11 @@
         if (*hostinfo == '[') {
             v6_offset1 = 1;
             v6_offset2 = 2;
-            s = uri;
-            do {
-                --s;
-            } while (s >= hostinfo && *s != ':' && *s != ']');
-            if (s < hostinfo || *s == ']') {
+            s = memchr(hostinfo, ']', uri - hostinfo);
+            if (s == NULL) {
+                return APR_EGENERAL;
+            }
+            if (*++s != ':') {
                 s = NULL; /* no port */
             }
         }
