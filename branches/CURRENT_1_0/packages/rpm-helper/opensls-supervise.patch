--- /dev/null	2001-01-02 16:30:38.000000000 -0700
+++ add-srv	2004-01-27 12:33:51.000000000 -0700
@@ -0,0 +1,33 @@
+#!/bin/sh
+
+# OpenSLS script to restart supervised service via rpm scriptlet
+
+if [ $# != 3 ]; then
+    echo "usage: $0 <pkg name> <number installed> <service name>" 1>&2
+    exit 1
+fi
+
+pkg=$1				# name of the package
+num=$2				# number of packages installed
+srv=$3				# name of the service
+
+if [ $num != 1 ]; then
+    # Upgrade mode: restart the service if already running
+    SRVSTAT=`/usr/bin/svstat /service/$srv|grep up; echo $?`
+    if [ "$SRVSTAT" = "0" ]; then
+	/usr/sbin/srv restart $srv || :
+	# restart services that depend of portmap
+	if [ $srv = portmap ]; then
+	    for s in amd autofs bootparamd clusternfs mcserv nfs nfslock ypserv ypbind yppasswdd ypxfrd; do
+		if [ -d /service/$s ]; then
+		    PSRVSTAT=`/usr/bin/svstat /service/$s|grep up; echo $?`
+		    if [ "$PSRVSTAT" = "0" ]; then
+			/usr/sbin/srv restart $srv || :
+		    fi
+		fi
+	    done
+	fi
+    fi
+fi
+
+# add-srv ends here
--- /dev/null	2001-01-02 16:30:38.000000000 -0700
+++ del-srv	2004-01-27 12:33:52.000000000 -0700
@@ -0,0 +1,21 @@
+#!/bin/sh
+
+# OpenSLS script to remove supervised service via rpm scriptlet
+
+if [ $# != 3 ]; then
+    echo "usage: $0 <pkg name> <number installed> <service name>" 1>&2
+    exit 1
+fi
+
+pkg=$1				# name of the package
+num=$2				# number of packages installed
+srv=$3				# name of the service
+
+if [ $num = 0 ]; then
+    if [ -d /service/$srv ]; then
+	/usr/sbin/srv stop $srv >/dev/null 2>&1 || :
+	/usr/sbin/srv del $srv
+    fi
+fi
+
+# del-srv ends here
--- Makefile~	2004-01-27 10:48:32.000000000 -0700
+++ Makefile	2004-01-27 10:48:32.000000000 -0700
@@ -15,7 +15,8 @@
 FILES = AUTHORS README README.CVS COPYING ChangeLog Makefile \
        $(PACKAGE).spec $(SCRIPTS)
 SCRIPTS = add-user del-user add-service del-service create-file \
-	add-group del-group add-shell del-shell verify-shell
+	add-group del-group add-shell del-shell verify-shell \
+	add-srv del-srv
 
 LIBDIR=/usr/share/rpm-helper
 
--- add-user~	2004-01-27 11:30:40.000000000 -0700
+++ add-user	2004-01-27 11:30:40.000000000 -0700
@@ -20,8 +20,9 @@
 name=$3				# name of the user
 dir=$4				# home directory
 shell=$5			# shell
+uid=$6				# uid to use
 
-/usr/sbin/useradd -r -M -s $shell -d $dir -c "system user for $pkg" $name > /dev/null 2>&1
+/usr/sbin/useradd -r -M -u $uid -s $shell -d $dir -c "system user for $pkg" $name > /dev/null 2>&1
 
 exit 0
 
