diff -Nurp -X /Data/dontdiff old/sound/core/Makefile patched/sound/core/Makefile
--- old/sound/core/Makefile	2003-08-29 23:56:43.000000000 +0300
+++ patched/sound/core/Makefile	2003-09-02 00:35:10.000000000 +0300
@@ -46,7 +46,7 @@ ifeq ($(filter $(subdir-y),oss),oss)
   obj-y += oss/_oss.o
 endif
 
-obj-$(CONFIG_SND_PCM_OSS) += snd-pcm.o snd-timer.o
+obj-$(CONFIG_SND_PCM_OSS) += snd-pcm.o snd-timer.o snd-page-alloc.o
 
 subdir-$(CONFIG_SND_SEQUENCER) += seq
 ifeq ($(CONFIG_SND_SEQUENCER),y)
@@ -137,6 +137,8 @@ obj-$(CONFIG_SND_VXPOCKET) += snd-pcm.o 
 obj-$(CONFIG_SND_VXP440) += snd-pcm.o snd-timer.o snd-page-alloc.o snd.o snd-hwdep.o
 obj-$(CONFIG_SND_VX222) += snd-pcm.o snd-timer.o snd-page-alloc.o snd.o snd-hwdep.o
 
+obj-m := $(sort $(obj-m))
+
 include $(TOPDIR)/Rules.make
 
 snd.o: $(snd-objs)
diff -Nurp -X /Data/dontdiff old/sound/core/seq/Makefile patched/sound/core/seq/Makefile
--- old/sound/core/seq/Makefile	2003-08-29 23:56:43.000000000 +0300
+++ patched/sound/core/seq/Makefile	2003-09-02 00:17:00.000000000 +0300
@@ -37,6 +37,15 @@ snd-seq-instr-objs := seq_instr.o
 snd-seq-dummy-objs := seq_dummy.o
 snd-seq-virmidi-objs := seq_virmidi.o
 
+RAWMIDI_OBJS = snd-seq-midi.o snd-seq-midi-event.o
+OPL3_OBJS = snd-seq-midi-event.o snd-seq-midi-emul.o snd-seq-instr.o
+
+#
+# this function returns:
+#   "m" - CONFIG_SND_SEQUENCER is m
+#   <empty string> - CONFIG_SND_SEQUENCER is undefined
+#   otherwise parameter #1 value
+#
 sequencer = $(if $(subst y,,$(CONFIG_SND_SEQUENCER)),$(if $(1),m),$(if $(CONFIG_SND_SEQUENCER),$(1)))
 
 obj-$(CONFIG_SND_SEQUENCER) += snd-seq.o snd-seq-device.o
@@ -46,56 +55,56 @@ endif
 obj-$(CONFIG_SND_SEQ_DUMMY) += snd-seq-dummy.o
 
 # Toplevel Module Dependency
-obj-$(CONFIG_SND_VIRMIDI) += snd-seq-virmidi.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_SERIAL_U16550) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_MTPAV) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_MPU401) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_ALS100) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_AZT2320) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_AZT3328) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_DT019X) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_ES18XX) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_OPL3SA2) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_AD1816A) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_CS4231) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_CS4232) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_CS4236) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_PC98_CS4232) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_ES1688) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_GUSCLASSIC) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_GUSMAX) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_GUSEXTREME) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_INTERWAVE) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_INTERWAVE_STB) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_OPTI92X_AD1848) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_OPTI92X_CS4231) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_OPTI93X) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_SB8) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_SB16) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_SBAWE) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o snd-seq-virmidi.o
-obj-$(CONFIG_SND_ES968) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_WAVEFRONT) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_SSCAPE) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_ALS4000) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_CMIPCI) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_CS4281) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_ENS1370) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_ENS1371) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_ES1938) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_ES1968) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_FM801) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_ICE1712) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_ICE1724) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_INTEL8X0) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_SONICVIBES) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_VIA82XX) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_ALI5451) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_CS46XX) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_EMU10K1) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-virmidi.o
-obj-$(CONFIG_SND_TRIDENT) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_YMFPCI) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o snd-seq-midi-emul.o snd-seq-instr.o
-obj-$(CONFIG_SND_USB_AUDIO) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
-obj-$(CONFIG_SND_HDSP) += snd-seq-virmidi.o snd-seq.o snd-seq-device.o snd-seq-midi-event.o snd-seq-midi.o
+obj-$(CONFIG_SND_VIRMIDI) += snd-seq-virmidi.o snd-seq-midi-event.o
+obj-$(CONFIG_SND_SERIAL_U16550) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_MTPAV) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_MPU401) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_ALS100) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_AZT2320) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_AZT3328) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_DT019X) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_ES18XX) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_OPL3SA2) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_AD1816A) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_CS4231) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_CS4232) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_CS4236) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_PC98_CS4232) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_ES1688) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_GUSCLASSIC) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_GUSMAX) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_GUSEXTREME) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_INTERWAVE) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_INTERWAVE_STB) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_OPTI92X_AD1848) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_OPTI92X_CS4231) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_OPTI93X) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_SB8) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_SB16) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_SBAWE) += $(RAWMIDI_OBJS) $(OPL3_OBJS) snd-seq-virmidi.o
+obj-$(CONFIG_SND_ES968) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_WAVEFRONT) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_SSCAPE) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_ALS4000) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_CMIPCI) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_CS4281) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_ENS1370) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_ENS1371) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_ES1938) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_ES1968) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_FM801) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_ICE1712) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_ICE1724) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_INTEL8X0) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_SONICVIBES) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_VIA82XX) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_ALI5451) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_CS46XX) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_EMU10K1) += $(RAWMIDI_OBJS) snd-seq-midi-emul.o snd-seq-virmidi.o
+obj-$(CONFIG_SND_TRIDENT) += $(RAWMIDI_OBJS) snd-seq-midi-emul.o snd-seq-instr.o
+obj-$(CONFIG_SND_YMFPCI) += $(RAWMIDI_OBJS) $(OPL3_OBJS)
+obj-$(CONFIG_SND_USB_AUDIO) += $(RAWMIDI_OBJS)
+obj-$(CONFIG_SND_HDSP) += $(RAWMIDI_OBJS)
 
 obj-m := $(sort $(obj-m))
 
diff -rup old/sound/Makefile old/sound.alsa/Makefile
--- old/sound/Makefile	2003-08-29 23:56:43.000000000 +0300
+++ old/sound.alsa/Makefile	2003-07-28 14:04:44.000000000 +0300
@@ -5,9 +5,11 @@ O_TARGET := alsa.o
 
 _subdirs := core i2c drivers isa pci ppc arm synth usb pcmcia
 
-subdir-$(CONFIG_SND) += $(_subdirs)
-
+//obj-$(CONFIG_SOUND) += soundcore.o
+//obj-$(CONFIG_SOUND_PRIME) += oss/
+//obj-$(CONFIG_DMASOUND) += oss/
 
+subdir-$(CONFIG_SND) += $(_subdirs)
 
 ifeq ($(CONFIG_SND),y)
   subdir-m += $(_subdirs)
@@ -21,6 +23,9 @@ ifeq ($(CONFIG_SND),y)
   obj-y += synth/_synth.o
   obj-y += usb/_usb.o
   obj-y += pcmcia/_pcmcia.o
+  obj-y += last.o
 endif
 
+//soundcore-objs  := sound_core.o sound_firmware.o
+
 include $(TOPDIR)/Rules.make
