diff -Naur dcron/crond.8 dcron.oden/crond.8
--- dcron/crond.8	1999-02-10 07:22:37.000000000 +0100
+++ dcron.oden/crond.8	2004-01-31 12:21:36.000000000 +0100
@@ -4,7 +4,7 @@
 .SH NAME
 crond \- cron daemon (Dillon's Cron)
 .SH SYNOPSIS
-.B crond [-l#] [-d[#]] [-f] [-b] [-c directory]
+.B crond [-l#] [-d[#]] [-f] [-b] [-c directory] [-m mailer] [-p pidfile]
 .SH OPTIONS
 .B crond
 is a background daemon that parses individual crontab files and
@@ -26,6 +26,14 @@
 .TP 0.5i
 .B "-c directory "
 specify directory containing crontab files.
+.TP 0.5i
+.B "-m mailer "
+specify program for sending mail and additional parameters which should be
+passed to it (default: "/usr/lib/sendmail -t -oem -i").
+.TP 0.5i
+.B "-p pidfile"
+specify file which the pid of crond should be written into (default:
+/var/run/dcron/crond.pid).
 .SH DESCRIPTION
 .B crond 
 is responsible for scanning the crontab files and running
@@ -52,7 +60,8 @@
 it.  Upon job completion, crond verifies the secureness of the mail file
 and, if it has been appended to, mails to the file to user.  The
 .B sendmail
-program is run under the user's uid to prevent mail related security holes.  
+program or any program specified through commandline switch -m (see above) is
+run under the user's uid to prevent mail related security holes.  
 Unlike
 .B crontab
 , the crond program does not leave an open descriptor to the file for the
diff -Naur dcron/defs.h dcron.oden/defs.h
--- dcron/defs.h	2002-12-17 21:06:51.000000000 +0100
+++ dcron.oden/defs.h	2004-01-31 12:35:58.000000000 +0100
@@ -21,12 +21,16 @@
 #include <sys/wait.h>
 #include <sys/stat.h>
 #include <sys/resource.h>
+#include <sys/termios.h>
 
 #define Prototype extern
 #define arysize(ary)	(sizeof(ary)/sizeof((ary)[0]))
 
 #ifndef CRONTABS
-#define CRONTABS	"/var/spool/cron/crontabs"
+#define CRONTABS	"/var/spool/dcron/crontabs"
+#endif
+#ifndef PIDFILE
+#define PIDFILE		"/var/run/dcron/dcron.pid"
 #endif
 #ifndef TMPDIR
 #define TMPDIR		"/tmp"
diff -Naur dcron/job.c dcron.oden/job.c
--- dcron/job.c	2002-12-17 21:05:35.000000000 +0100
+++ dcron.oden/job.c	2004-01-31 12:21:36.000000000 +0100
@@ -10,6 +10,9 @@
 
 Prototype void RunJob(CronFile *file, CronLine *line);
 Prototype void EndJob(CronFile *file, CronLine *line);
+Prototype void GetMailer(char *cmdline);
+
+char **mailer = NULL;
 
 void
 RunJob(CronFile *file, CronLine *line)
@@ -30,7 +33,7 @@
 
     if (mailFd >= 0) {
 	line->cl_MailFlag = 1;
-	fdprintf(mailFd, "To: %s\nSubject: cron: %s\n\n", 
+	printffd(mailFd, "To: %s\nSubject: cron: %s\n\n", 
 	    file->cf_User,
 	    line->cl_Shell
 	);
@@ -91,7 +94,7 @@
 	    file->cf_User,
 	    line->cl_Shell
 	);
-	fdprintf(1, "Exec failed: /bin/sh -c %s\n", line->cl_Shell);
+	printffd(1, "Exec failed: /bin/sh -c %s\n", line->cl_Shell);
 	exit(0);
     } else if (line->cl_Pid < 0) {
 	/*
@@ -209,13 +212,21 @@
 	dup2(1, 2);
 	close(mailFd);
 
+	if (mailer) {
+	    execv(mailer[0], mailer);
+	    logfd(8, "unable to exec %s, user %s, "
+		"using default mailer " SENDMAIL "\n",
+		mailer[0],
+		file->cf_User
+	    );
+	    free(mailer);
+	}
 	execl(SENDMAIL, SENDMAIL, SENDMAIL_ARGS, NULL, NULL);
 	/*
 	 * note: 8 is a file descriptor
 	 */
-	logfd(8, "unable to exec %s %s, user %s, output to sink null", 
-	    SENDMAIL,
-	    SENDMAIL_ARGS,
+	logfd(8,
+	    "unable to exec " SENDMAIL ", user %s, output to sink null\n", 
 	    file->cf_User
 	);
 	exit(0);
@@ -233,3 +244,40 @@
     close(mailFd);
 }
 
+/*
+ * GetMailer - parses cmdline argument (-m) and sets mailer (to NULL on failure)
+ */
+
+void
+GetMailer(char *cmdline)
+{
+  int argc = 0; /* number of arguments passed to the mail program */
+  char *space = cmdline;
+
+  while (space) {
+    /*
+     * get memory for the array of strings
+     */
+    if (!(mailer = realloc(mailer, (argc + 2) * sizeof(char*)))) {
+      logfd(8, "realloc failed, using default mailer " SENDMAIL "\n");
+      mailer = NULL;
+      return;
+    }
+
+    /*
+     * eg. cmdline arg (-m) = "/var/qmail/bin/qmail-inject -A -fcron"
+     * mailer[0] = "/var/qmail/bin/qmail-inject"
+     * mailer[1] = "-A"
+     * mailer[2] = "-fcron"
+     */
+    *(mailer + argc) = space;
+    ++argc;
+
+    if ((space = strchr(space, ' '))) *space++ = '\0';
+  }
+
+  /*
+   * mailer[3] = NULL
+   */
+  *(mailer + argc) = NULL;
+}
diff -Naur dcron/main.c dcron.oden/main.c
--- dcron/main.c	2002-12-17 21:05:44.000000000 +0100
+++ dcron.oden/main.c	2004-01-31 12:21:44.000000000 +0100
@@ -23,6 +23,7 @@
 short ForegroundOpt;
 char  *CDir = CRONTABS;
 int DaemonUid;
+char *pidfile = PIDFILE;
 
 int
 main(int ac, char **av)
@@ -58,6 +59,14 @@
 	    case 'c':
 		CDir = (*ptr) ? ptr : av[++i];
 		continue;
+	    case 'm':
+		if (!*ptr) ptr = av[++i];
+		GetMailer(ptr);
+		continue;
+	    case 'p':
+		if (!*ptr) ptr = av[++i];
+		pidfile = ptr;
+		continue;
 	    default:
 		break;
 	    }
@@ -73,7 +82,7 @@
         if (i > ac)
             puts("expected argument for option");
 	printf("dcron " VERSION "\n");
-	printf("dcron -d[#] -l[#] -f -b -c dir\n");
+	printf("dcron -d[#] -l[#] -f -b -c dir -m mailer -p pidfile\n");
 	exit(1);
     }
 
@@ -124,6 +133,12 @@
         }
         if (pid > 0)
             exit(0);
+
+	if ((fd = open(pidfile, O_WRONLY | O_CREAT | O_TRUNC,
+	  S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP)) >= 0) {
+	    printffd(fd, "%i\n", getpid());
+	    close(fd);
+	}
     }
 
     /* 
diff -Naur dcron/Makefile dcron.oden/Makefile
--- dcron/Makefile	2002-12-17 21:08:49.000000000 +0100
+++ dcron.oden/Makefile	2004-01-31 12:27:47.000000000 +0100
@@ -1,8 +1,8 @@
 # Makefile for dillon's cron and crontab
 #
 
-CC  = gcc
-CFLAGS = -O2 -Wall -Wstrict-prototypes
+CC  = diet gcc
+CFLAGS = -Os -Wall -Wstrict-prototypes
 LIB = 
 SRCS = main.c subs.c database.c job.c
 OBJS = main.o subs.o database.o job.o
@@ -10,16 +10,27 @@
 D_OBJS = crontab.o subs.o
 PROTOS= protos.h
 DISTTAR= /home/httpd/htdocs/FreeSrc/dcron29.tgz
+STRIP=strip
+DESTDIR=
+BINDIR=/usr/bin
+SBINDIR=/usr/bin
+MANDIR=/usr/man
+CRONTAB_OWNER=root:cron
+CROND_OWNER=root:wheel
+CRONTAB_PERM=4750
+CROND_PERM=0700
+
+.PHONY:	all clean cleano install tar
 
 all:	${PROTOS} crond crontab
 
-crond:	${OBJS}
+crond:	${OBJS} ${PROTOS}
 	${CC} ${CFLAGS} -o crond ${OBJS} ${LIB}
-	strip crond
+	$(STRIP) crond
 
-crontab:  ${D_OBJS}
+crontab:  ${D_OBJS} ${PROTOS}
 	${CC} ${CFLAGS} -o crontab ${D_OBJS}
-	strip crontab
+	$(STRIP) crontab
 
 protos.h: ${SRCS} ${D_SRCS}
 	fgrep -h Prototype ${SRCS} ${D_SRCS} >protos.h
@@ -30,19 +41,19 @@
 cleano:
 	rm -f *.o dcron.tgz $(PROTOS)
 
-install:
-	rm -f /usr/bin/crond /usr/bin/crontab
-	cp crond crontab /usr/bin
-	chown root.wheel /usr/bin/crond
-	chown root.cron /usr/bin/crontab
-	chmod 700 /usr/bin/crond
-	chmod 4750 /usr/bin/crontab
-	-mkdirs /usr/man/man1
-	-mkdirs /usr/man/man8
-	cp crontab.1 /usr/man/man1
-	cp crond.8 /usr/man/man8
-	chmod 444 /usr/man/man1/crontab.1
-	chmod 444 /usr/man/man8/crond.8
+install:	crontab crond
+	mkdir -p $(DESTDIR)$(BINDIR) $(DESTDIR)$(SBINDIR) \
+	$(DESTDIR)$(MANDIR)/man1 $(DESTDIR)$(MANDIR)/man8
+	cp crontab $(DESTDIR)$(BINDIR)
+	cp crond $(DESTDIR)$(SBINDIR)
+	chown $(CRONTAB_OWNER) $(DESTDIR)$(BINDIR)/crontab
+	chown $(CROND_OWNER) $(DESTDIR)$(SBINDIR)/crond
+	chmod $(CRONTAB_PERM) $(DESTDIR)$(BINDIR)/crontab
+	chmod $(CROND_PERM) $(DESTDIR)$(SBINDIR)/crond
+	cp crontab.1 $(DESTDIR)$(MANDIR)/man1
+	cp crond.8 $(DESTDIR)$(MANDIR)/man8
+	chmod 644 $(DESTDIR)$(MANDIR)/man1/crontab.1
+	chmod 644 $(DESTDIR)$(MANDIR)/man8/crond.8
 
 # dillon-specific
 #
diff -Naur dcron/subs.c dcron.oden/subs.c
--- dcron/subs.c	1999-02-10 07:31:46.000000000 +0100
+++ dcron.oden/subs.c	2004-01-31 12:21:44.000000000 +0100
@@ -11,7 +11,7 @@
 Prototype void log(int level, const char *ctl, ...);
 Prototype void log9(const char *ctl, ...);
 Prototype void logfd(int fd, const char *ctl, ...);
-Prototype void fdprintf(int fd, const char *ctl, ...);
+Prototype void printffd(int fd, const char *ctl, ...);
 Prototype int ChangeUser(const char *user, short dochdir);
 Prototype void vlog(int level, int fd, const char *ctl, va_list va);
 Prototype int slog(char *buf, const char *ctl, int nmax, va_list va, short useDate);
@@ -47,7 +47,7 @@
 }
 
 void 
-fdprintf(int fd, const char *ctl, ...)
+printffd(int fd, const char *ctl, ...)
 {
     va_list va;
     char buf[2048];
@@ -79,7 +79,7 @@
 
     buf[0] = 0;
     if (useDate)
-	strftime(buf, 128, "%d-%b-%y %H:%M  ", tp);
+	strftime(buf, 128, "%d-%b-%Y %H:%M  ", tp);
     vsnprintf(buf + strlen(buf), nmax, ctl, va);
     return(strlen(buf));
 }
@@ -97,9 +97,15 @@
         log(9, "failed to get uid for %s", user);
         return(-1);
     }
-    setenv("USER", pas->pw_name, 1);
-    setenv("HOME", pas->pw_dir, 1);
-    setenv("SHELL", "/bin/sh", 1);
+    {
+        char buf[256];
+        snprintf(buf, sizeof(buf), "USER=%s", pas->pw_name);
+        putenv(buf);
+        snprintf(buf, sizeof(buf), "HOME=%s", pas->pw_dir);
+        putenv(buf);
+        snprintf(buf, sizeof(buf), "SHELL=%s", "/bin/sh");
+        putenv(buf);
+    }
 
     /*
      * Change running state to the user in question
