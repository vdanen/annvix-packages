--- samba-3.0.6/packaging/Mandrake/smb.conf.mdk	2004-08-19 16:39:34.000000000 +0200
+++ samba-3.0.6/packaging/Mandrake/smb.conf	2004-09-08 20:25:50.431814902 +0200
@@ -21,7 +21,7 @@
 
 # netbios name is the name you will see in "Network Neighbourhood",
 # but defaults to your hostname
-;  netbios name = <name_of_this_server>
+#  netbios name = <name_of_this_server>
 
 # server string is the equivalent of the NT Description field
    server string = Samba Server %v
@@ -49,9 +49,9 @@
 # Note that this feature uses the print$ share, so you will need to 
 # enable it below.
 # printer admin = @<group> <user>
-;   printer admin = @adm
+   printer admin = @adm
 # This should work well for winbind:
-;   printer admin = @"Domain Admins"
+#   printer admin = @"Domain Admins"
 
 # 3. Logging Options:
 # this tells Samba to use a separate log file for each machine
@@ -62,7 +62,7 @@
    max log size = 50
 
 # Set the log (verbosity) level (0 <= log level <= 10)
-; log level = 3
+# log level = 3
 
 # 4. Security and Domain Membership Options:
 # This option is important for security. It allows you to restrict
@@ -71,11 +71,11 @@
 # the "loopback" interface. For more examples of the syntax see
 # the smb.conf man page. Do not enable this if (tcp/ip) name resolution does
 # not work for all the hosts in your network.
-;   hosts allow = 192.168.1. 192.168.2. 127.
+#   hosts allow = 192.168.1. 192.168.2. 127.
 
 # Uncomment this if you want a guest account, you must add this to /etc/passwd
 # otherwise the user "nobody" is used
-;  guest account = pcguest
+#  guest account = pcguest
 # Allow users to map to guest:
   map to guest = bad user
 
@@ -84,13 +84,13 @@
    security = user
 # Use password server option only with security = server or security = domain
 # When using security = domain, you should use password server = *
-;   password server = <NT-Server-Name>
-;   password server = *
+#   password server = <NT-Server-Name>
+#   password server = *
 
 # Password Level allows matching of _n_ characters of the password for
 # all combinations of upper and lower case.
-;  password level = 8
-;  username level = 8
+#  password level = 8
+#  username level = 8
 
 # You may wish to use password encryption. Please read
 # ENCRYPTION.txt, Win95.txt and WinNT.txt in the Samba documentation.
@@ -111,7 +111,7 @@
 # You either need to setup a passwd program and passwd chat, or
 # enable pam password change
 ;  pam password change = yes
-;  passwd program = /usr/bin/passwd %u
+#  passwd program = /usr/bin/passwd '%u'
 ;  passwd chat = *New*UNIX*password* %n\n *Re*ype*new*UNIX*password* %n\n \
 ;*passwd:*all*authentication*tokens*updated*successfully*
 
@@ -121,7 +121,7 @@
 # Using the following line enables you to customise your configuration
 # on a per machine basis. The %m gets replaced with the netbios name
 # of the machine that is connecting
-;   include = /etc/samba/smb.conf.%m
+#   include = /etc/samba/smb.conf.%m
 
 # Options for using winbind. Winbind allows you to do all account and
 # authentication from a Windows or samba domain controller, creating
@@ -129,33 +129,33 @@
 # and gid's. winbind uid and winbind gid are the only required parameters.
 #
 # winbind uid is the range of uid's winbind can use when mapping RIDs to uid's
-;  idmap uid = 10000-20000
+#  idmap uid = 10000-20000
 #
 # winbind gid is the range of uid's winbind can use when mapping RIDs to gid's
-;  idmap gid = 10000-20000
+#  idmap gid = 10000-20000
 #
 # winbind separator is the character a user must use between their domain
 # name and username, defaults to "\"
-;  winbind separator = +
+#  winbind separator = +
 #
 # winbind use default domain allows you to have winbind return usernames
 # in the form user instead of DOMAIN+user for the domain listed in the
 # workgroup parameter.
-;  winbind use default domain = yes
+#  winbind use default domain = yes
 #
 # template homedir determines the home directory for winbind users, with 
 # %D expanding to their domain name and %U expanding to their username:
-;  template homedir = /home/%D/%U
+#  template homedir = /home/%D/%U
 
 # When using winbind, you may want to have samba create home directories
 # on the fly for authenticated users. Ensure that /etc/pam.d/samba is
 # using 'service=system-auth-winbind' in pam_stack modules, and then
 # enable obedience of pam restrictions below:
-;  obey pam restrictions = yes
+#  obey pam restrictions = yes
 
 #
 # template shell determines the shell users authenticated by winbind get
-;  template shell = /bin/bash
+#  template shell = /bin/bash
 
 # 5. Browser Control and Networking Options:
 # Most people will find that this option gives better performance.
@@ -165,52 +165,52 @@
 # Configure Samba to use multiple interfaces
 # If you have multiple network interfaces then you must list them
 # here. See the man page for details.
-;   interfaces = 192.168.12.2/24 192.168.13.2/24 
+#   interfaces = 192.168.12.2/24 192.168.13.2/24 
 
 # Configure remote browse list synchronisation here
 #  request announcement to, or browse list sync from:
 #       a specific host or from / to a whole subnet (see below)
-;   remote browse sync = 192.168.3.25 192.168.5.255
+#   remote browse sync = 192.168.3.25 192.168.5.255
 # Cause this host to announce itself to local subnets here
-;   remote announce = 192.168.1.255 192.168.2.44
+#   remote announce = 192.168.1.255 192.168.2.44
 
 # set local master to no if you don't want Samba to become a master
 # browser on your network. Otherwise the normal election rules apply
-;   local master = no
+#   local master = no
 
 # OS Level determines the precedence of this server in master browser
 # elections. The default value should be reasonable
-;   os level = 33
+#   os level = 33
 
 # Domain Master specifies Samba to be the Domain Master Browser. This
 # allows Samba to collate browse lists between subnets. Don't use this
 # if you already have a Windows NT domain controller doing this job
-;   domain master = yes 
+#   domain master = yes 
 
 # Preferred Master causes Samba to force a local browser election on startup
 # and gives it a slightly higher chance of winning the election
-;   preferred master = yes
+#   preferred master = yes
 
 # 6. Domain Control Options:
 # Enable this if you want Samba to be a domain logon server for 
 # Windows95 workstations or Primary Domain Controller for WinNT and Win2k
-;   domain logons = yes
+#   domain logons = yes
 
 # if you enable domain logons then you may want a per-machine or
 # per user logon script
 # run a specific logon batch file per workstation (machine)
-;   logon script = %m.bat
+#   logon script = %m.bat
 # run a specific logon batch file per username
-;   logon script = %U.bat
+#   logon script = %u.bat
 
 # Where to store roaming profiles for WinNT and Win2k
-#        %L substitutes for this servers netbios name, %U is username
+#        %L substitutes for this servers netbios name, %u is username
 #        You must uncomment the [Profiles] share below
-;   logon path = \\%L\Profiles\%U
+#   logon path = \\%L\Profiles\%u
 
 # Where to store roaming profiles for Win9x. Be careful with this as it also
 # impacts where Win2k finds it's /HOME share
-; logon home = \\%L\%U\.profile
+# logon home = \\%L\%u\.profile
 
 
 # The add user script is used by a domain member to add local user accounts
@@ -218,23 +218,23 @@
 # users via the Windows NT Tools (ie User Manager for Domains).
 
 # Scripts for file (passwd, smbpasswd) backend:
-; add user script = /usr/sbin/useradd -s /bin/false '%u'
-; delete user script = /usr/sbin/userdel '%s'
-; add user to group script = /usr/bin/gpasswd -a '%u' '%g'
-; delete user from group script = /usr/bin/gpasswd -d '%u' '%g'
-; set primary group script = /usr/sbin/usermod -g '%g' '%u'
-; add group script = /usr/sbin/groupadd %g && getent group '%g'|awk -F: '{print $3}'
-; delete group script = /usr/sbin/groupdel '%g'
+# add user script = /usr/sbin/useradd -s /bin/false '%u'
+# delete user script = /usr/sbin/userdel '%s'
+# add user to group script = /usr/bin/gpasswd -a '%u' '%g'
+# delete user from group script = /usr/bin/gpasswd -d '%u' '%g'
+# set primary group script = /usr/sbin/usermod -g '%g' '%u'
+# add group script = /usr/sbin/groupadd %g && getent group '%g'|awk -F: '{print $3}'
+# delete group script = /usr/sbin/groupdel '%g'
 
 # Scripts for LDAP backend (assumes nss_ldap is in use on the domain controller,
 # and needs configuration in smbldap_conf.pm
-; add user script = /usr/share/samba/scripts/smbldap-useradd.pl '%u'
-; delete user script = /usr/share/samba/scripts/smbldap-userdel.pl '%u'
-; add user to group script = /usr/share/samba/scripts/smbldap-groupmod.pl -m '%u' '%g'
-; delete user from group script = /usr/share/samba/scripts/smbldap-groupmod.pl -x '%u' '%g'
-; set primary group script = /usr/share/samba/scripts/smbldap-usermod.pl -g '%g' '%u'
-; add group script = /usr/share/samba/scripts/smbldap-groupadd.pl '%g' && /usr/share/samba/scripts/smbldap-groupshow.pl %g|awk '/^gidNumber:/ {print $2}'
-; delete group script = /usr/share/samba/scripts/smbldap-userdel.pl '%g'
+# add user script = /usr/share/samba/scripts/smbldap-useradd.pl '%u'
+# delete user script = /usr/share/samba/scripts/smbldap-userdel.pl '%u'
+# add user to group script = /usr/share/samba/scripts/smbldap-groupmod.pl -m '%u' '%g'
+# delete user from group script = /usr/share/samba/scripts/smbldap-groupmod.pl -x '%u' '%g'
+# set primary group script = /usr/share/samba/scripts/smbldap-usermod.pl -g '%g' '%u'
+# add group script = /usr/share/samba/scripts/smbldap-groupadd.pl '%g' && /usr/share/samba/scripts/smbldap-groupshow.pl %g|awk '/^gidNumber:/ {print $2}'
+# delete group script = /usr/share/samba/scripts/smbldap-userdel.pl '%g'
 
 
 # The add machine script is use by a samba server configured as a domain
@@ -242,10 +242,10 @@
 # The script must work from the command line when replacing the macros,
 # or the operation will fail. Check that groups exist if forcing a group.
 # Script for domain controller for adding machines:
-; add machine script = /usr/sbin/useradd -d /dev/null -g machines -c 'Machine Account' -s /bin/false -M %u
+# add machine script = /usr/sbin/useradd -d /dev/null -g machines -c 'Machine Account' -s /bin/false -M '%u'
 # Script for domain controller with LDAP backend for adding machines (please
 # configure in /etc/samba/smbldap_conf.pm first):
-; add machine script = /usr/share/samba/scripts/smbldap-useradd.pl -w -d /dev/null -g machines -c 'Machine Account' -s /bin/false %u
+# add machine script = /usr/share/samba/scripts/smbldap-useradd.pl -w -d /dev/null -g machines -c 'Machine Account' -s /bin/false '%u'
 
 # Domain groups:
 # Domain groups are now configured by using the 'net groupmap' tool
@@ -254,41 +254,41 @@
 # Samba now has runtime-configurable password database backends. Multiple
 # passdb backends may be used, but users will only be added to the first one
 # Default:
-; passdb backend = smbpasswd guest
+# passdb backend = smbpasswd guest
 # TDB backen with fallback to smbpasswd and guest
-; passdb backend = tdbsam smbpasswd guest
+# passdb backend = tdbsam smbpasswd guest
 # LDAP with fallback to smbpasswd guest
 # Enable SSL by using an ldaps url, or enable tls with 'ldap ssl' below.
-; passdb backend = ldapsam:ldaps://ldap.mydomain.com smbpasswd guest
+# passdb backend = ldapsam:ldaps://ldap.mydomain.com smbpasswd guest
 # Use the samba2 LDAP schema:
-; passdb backend = ldapsam_compat:ldaps://ldap.mydomain.com smbpasswd guest
+# passdb backend = ldapsam_compat:ldaps://ldap.mydomain.com smbpasswd guest
 
 # Idmap settings (set idmap uid and idmap gid above):
 # Idmap backend to use:
-; idmap backend = ldap:ldap://ldap.mydomain.com
+# idmap backend = ldap:ldap://ldap.mydomain.com
 
 # LDAP configuration for Domain Controlling:
 # The account (dn) that samba uses to access the LDAP server
 # This account needs to have write access to the LDAP tree
 # You will need to give samba the password for this dn, by 
 # running 'smbpasswd -w mypassword'
-; ldap admin dn = cn=root,dc=mydomain,dc=com
-; ldap ssl = start_tls
+# ldap admin dn = cn=root,dc=mydomain,dc=com
+# ldap ssl = start_tls
 # start_tls should run on 389, but samba defaults incorrectly to 636
-; ldap port = 389
-; ldap suffix = dc=mydomain,dc=com
+# ldap port = 389
+# ldap suffix = dc=mydomain,dc=com
 # Seperate suffixes are available for machines, users, groups, and idmap, if 
 # ldap suffix appears first, it is appended to the specific suffix.
 # Example for a unix-ish directory layout:
-; ldap machine suffix = ou=Hosts
-; ldap user suffix = ou=People
-; ldap group suffix = ou=Group
-; ldap idmap suffix = ou=Idmap
+# ldap machine suffix = ou=Hosts
+# ldap user suffix = ou=People
+# ldap group suffix = ou=Group
+# ldap idmap suffix = ou=Idmap
 # Example for AD-ish layout:
-; ldap machine suffix = cn=Computers
-; ldap user suffix = cn=Users
-; ldap group suffix = cn=Groups
-; ldap idmap suffix = cn=Idmap
+# ldap machine suffix = cn=Computers
+# ldap user suffix = cn=Users
+# ldap group suffix = cn=Groups
+# ldap idmap suffix = cn=Idmap
 
 
 # 7. Name Resolution Options:
@@ -303,20 +303,20 @@
 # The example below excludes use of name resolution for machines that are NOT
 # on the local network segment
 # - OR - are not deliberately to be known via lmhosts or via WINS.
-; name resolve order = wins lmhosts bcast
+# name resolve order = wins lmhosts bcast
 
 # Windows Internet Name Serving Support Section:
 # WINS Support - Tells the NMBD component of Samba to enable it's WINS Server
-;   wins support = yes
+#   wins support = yes
 
 # WINS Server - Tells the NMBD components of Samba to be a WINS Client
 #       Note: Samba can be either a WINS Server, or a WINS Client, but NOT both
-;   wins server = w.x.y.z
+#   wins server = w.x.y.z
 
 # WINS Proxy - Tells Samba to answer name resolution queries on
 # behalf of a non WINS capable client, for this to work there must be
 # at least one  WINS Server on the network. The default is NO.
-;   wins proxy = yes
+#   wins proxy = yes
 
 # DNS Proxy - tells Samba whether or not to try to resolve NetBIOS names
 # via DNS nslookups. The built-in default for versions 1.9.17 is yes,
@@ -326,12 +326,12 @@
 # 8. File Naming Options:
 # Case Preservation can be handy - system default is _no_
 # NOTE: These can be set on a per share basis
-;  preserve case = no
-;  short preserve case = no
+#  preserve case = no
+#  short preserve case = no
 # Default case is normally upper case for all DOS files
-;  default case = lower
+#  default case = lower
 # Be very careful with case sensitivity - it can break things!
-;  case sensitive = no
+#  case sensitive = no
 
 # Enabling internationalization:
 # you can match a Windows code page with a UNIX character set.
@@ -342,8 +342,8 @@
 # UNIX: ISO8859-1 (Western European), ISO8859-2 (Eastern Eu.),
 # ISO8859-5 (Russian Cyrillic), KOI8-R (Alt-Russ. Cyril.)
 # This is an example for french users:
-;   dos charset = 850
-;   unix charset = ISO8859-1
+#   dos charset = 850
+#   unix charset = ISO8859-1
 
 
 #============================ Share Definitions ==============================
@@ -357,37 +357,37 @@
 # the base of the share and ensure all users will have write access to it.
 # For virus scanning, install samba-vscan-clamav and ensure the clamd service
 # is running
-;   vfs objects = vscan-clamav recycle
-;   vscan-clamav: config-file = /etc/samba/vscan-clamav.conf
+#   vfs objects = vscan-clamav recycle
+#   vscan-clamav: config-file = /etc/samba/vscan-clamav.conf
 
 # Un-comment the following and create the netlogon directory for Domain Logons
-; [netlogon]
-;   comment = Network Logon Service
-;   path = /var/lib/samba/netlogon
-;   guest ok = yes
-;   writable = no
+# [netlogon]
+#   comment = Network Logon Service
+#   path = /var/lib/samba/netlogon
+#   guest ok = yes
+#   writable = no
 
 #Uncomment the following 2 lines if you would like your login scripts to
 #be created dynamically by ntlogon (check that you have it in the correct
 #location (the default of the ntlogon rpm available in contribs)
-;root preexec = /usr/bin/ntlogon -u %U -g %G -o %a -d /var/lib/samba/netlogon/
-;root postexec = rm -f /var/lib/samba/netlogon/%U.bat
+#root preexec = /usr/bin/ntlogon -u '%u' -g '%g' -o %a -d /var/lib/samba/netlogon/
+#root postexec = rm -f '/var/lib/samba/netlogon/%u.bat'
 
 # Un-comment the following to provide a specific roving profile share
 # the default is to use the user's home directory
-;[Profiles]
-;    path = /var/lib/samba/profiles
-;    browseable = no
-;    guest ok = yes
-;    writable = yes
+#[Profiles]
+#    path = /var/lib/samba/profiles
+#    browseable = no
+#    guest ok = yes
+#    writable = yes
 # This script can be enabled to create profile directories on the fly
 # You may want to turn off guest acces if you enable this, as it
 # hasn't been thoroughly tested.
-;root preexec = PROFILE=/var/lib/samba/profiles/%u; if [ ! -e $PROFILE ]; \
-;                then mkdir -pm700 $PROFILE; chown %u.%g $PROFILE;fi
+#root preexec = PROFILE='/var/lib/samba/profiles/%u'; if [ ! -e $PROFILE ]; \
+#                then mkdir -pm700 $PROFILE; chown '%u':'%g' $PROFILE;fi
 # If you want read-only profiles, fake permissions so windows clients think
 # they have written to the files
-; vfs objects = fake_perms
+# vfs objects = fake_perms
 
 # NOTE: If you have a CUPS print system there is no need to 
 # specifically define each individual printer.
@@ -412,7 +412,10 @@
 # print command: see above for details.
 # =====================================
    print command = lpr-cups -P %p -o raw %s -r   # using client side printer drivers.
-;   print command = lpr-cups -P %p %s # using cups own drivers (use generic PostScript on clients).
+#   print command = lpr-cups -P %p %s # using cups own drivers (use generic PostScript on clients).
+# If you install drivers on the server, you will want to uncomment this so
+# clients request the driver 
+   use client driver = yes
 
 # This share is used for Windows NT-style point-and-print support.
 # To be able to install drivers, you need to be either root, or listed
@@ -433,25 +436,34 @@
    guest ok = yes
    inherit permissions = yes
    # Settings suitable for Winbind:
-   ; write list = @"Domain Admins" root
-   ; force group = +@"Domain Admins"
+   # write list = @"Domain Admins" root
+   # force group = +@"Domain Admins"
 
 # A useful application of samba is to make a PDF-generation service
 # To streamline this, install windows postscript drivers (preferably colour)
 # on the samba server, so that clients can automatically install them.
 # Note that this only works if 'printing' is *not* set to 'cups'
 
-[pdf-generator]
+[pdf-gen]
    path = /var/tmp
    guest ok = No
    printable = Yes
    comment = PDF Generator (only valid users)
    printing = bsd
-   printcap name = lpstat
+   printcap name = cups
    #print command = /usr/share/samba/scripts/print-pdf file path win_path recipient IP &
-   print command = /usr/share/samba/scripts/print-pdf %s %H //%L/%u %m %I "%J" &
+   print command = /usr/share/samba/scripts/print-pdf "%s" "%H" "//%L/%u" "%m" "%I" "%J" &
     lpq command = /bin/true
 
+# A share allowing administrators to set ACLs on, or access for backup purposes
+# ll files (as root).
+#[admin] 
+#  path = /
+#  admin users = @"Domain Admins"
+#  valid users = @"Domain Admins"
+#  browseable = no
+#  writeable = yes 
+
 # This one is useful for people to share files
 ;[tmp]
 ;   comment = Temporary file space
@@ -469,7 +481,7 @@
 ;   write list = @staff
 # Audited directory through experimental VFS audit.so module:
 # Uncomment next line.
-;   vfs object = /usr/lib/samba/vfs/audit.so
+#   vfs object = /usr/lib/samba/vfs/audit.so
 
 # Other examples. 
 #
@@ -505,18 +517,6 @@
 ;  public = no
 ;  writable = yes
 
-# A publicly accessible directory, read/write to all users. Note that all files
-# created in the directory by users will be owned by the default user, so
-# any user with access can delete any other user's files. Obviously this
-# directory must be writable by the default user. Another user could of course
-# be specified, in which case all files would be owned by that user instead.
-;[public]
-;   path = /usr/somewhere/else/public
-;   public = yes
-;   only guest = yes
-;   writable = yes
-;   printable = no
-
 # The following two entries demonstrate how to share a directory so that two
 # users can place files there that will be owned by the specific users. In this
 # setup, the directory should be writable by both users and should have the
--- samba-3.0.6/packaging/Mandrake/samba2.spec.tmpl.mdk	2004-08-19 16:39:34.000000000 +0200
+++ samba-3.0.6/packaging/Mandrake/samba2.spec.tmpl	2004-09-08 20:37:19.743366363 +0200
@@ -13,10 +13,14 @@
 # cvs should be submitted for inclusion in samba cvs.
 
 %define pkg_name	samba
-%define ver 		3.0.5
-%define rel 		2mdk
+%define ver 		3.0.6
+%define drel		5
+%define	subrel		1
 %define vscanver 	0.3.5
 %define libsmbmajor 	0
+%{?!mdkversion: %define mdkversion %(perl -pe '/(\d+)\.(\d)\.?(\d)?/; $_="$1$2".($3||0)' /etc/mandrake-release)}
+%define rel		%(case `hostname` in (n?.mandrakesoft.com) echo %drel;;(*) echo $[%drel-1].%subrel.$[%mdkversion/10];;esac)mdk
+%{?_with_stable_on_cluster: %define rel %(echo $[%{drel}-1].%subrel.$[%{mdkversion}/10]mdk)}
 
 %{!?lib: %global lib lib}
 %{!?mklibname: %global mklibname(ds) %lib%{1}%{?2:%{2}}%{?3:_%{3}}%{-s:-static}%{-d:-devel}}
@@ -57,7 +61,6 @@
 %endif
 
 # We now do detection of the Mandrake release we are building on:
-%{?!mdkversion: %define mdkversion %(perl -pe '/(\d+)\.(\d)\.?(\d)?/; $_="$1$2".($3||0)' /etc/mandrake-release)}
 %define build_mdk82 %(if [ `awk '{print $4}' /etc/mandrake-release` = 8.2 ];then echo 1; else echo 0; fi)
 %define build_mdk81 %(if [ `awk '{print $4}' /etc/mandrake-release` = 8.1 ];then echo 1; else echo 0; fi)
 %define build_mdk80 %(if [ `awk '{print $4}' /etc/mandrake-release` = 8.0 ];then echo 1; else echo 0; fi)
@@ -271,6 +274,8 @@
 Source7: README.%{name}-mandrake-rpm
 %if %build_vscan
 Source8: samba-vscan-%{vscanver}.tar.bz2
+%endif
+%if %build_vscan && %mdkversion >= 920
+BuildRequires: file-devel
-BuildRequires: libmagic-devel
 %endif
 Source10: samba-print-pdf.sh.bz2
@@ -280,8 +285,15 @@
 Patch5:	samba-3.0.2a-smbldap-config.patch.bz2
 %if !%have_pversion
 # Version specific patches: current version
-Patch6: samba-3.0.5-mandrake-packaging.patch.bz2
 Patch7: samba-3.0.5-lib64.patch.bz2
+Patch8:	samba-3.0.6-revert-libsmbclient-move.patch.bz2
+Patch9:	samba-3.0.6-smbmount-unixext.patch.bz2
+Patch10: samba-3.0.6-rpcclient-dont-link-excess-libs.patch.bz2
+#Jerry's post-3.0.6 patchs
+Patch21: samba-3.0.6-homes-reuse_v2.patch.bz2
+Patch22: samba-3.0.6-winbind_getpwnam_v1.patch.bz2
+Patch23: samba-3.0.6-ldap-schema-update.patch.bz2
+Patch24: samba-3.0.6-printing_fixes_v1.patch.bz2
 %else
 # Version specific patches: upcoming version
 %endif
@@ -893,8 +905,17 @@
 # Version specific patches: current version
 %if !%have_pversion
 echo "Applying patches for current version: %{ver}"
-%patch6 -p1 -b .mdk
-%patch7 -p1 -b .lib64
+#%patch7 -p1 -b .lib64
+%patch8 -p1 -b .libsmbdir
+%patch9 -p1 -b .unixext
+%patch10 -p1 -b .rpcclient-libs
+pushd source
+# patches from cvs/jerry
+%patch21
+%patch22
+popd
+%patch23 -p1
+%patch24 -p1
 %else
 # Version specific patches: upcoming version
 echo "Applying patches for new versions: %{pversion}"
@@ -954,6 +975,7 @@
 %if %gcc331
 CFLAGS=`echo "$CFLAGS"|sed -e 's/-O2/-O/g'`
 %endif
+./autogen.sh
 # Don't use --with-fhs now, since it overrides libdir, it sets configdir, 
 # lockdir,piddir logfilebase,privatedir and swatdir
 %configure      --prefix=%{_prefix} \
@@ -1544,7 +1566,7 @@
 %(for i in %{_bindir}/{%{clientbin}}%{alternative_major};do echo $i;done)
 %(for i in %{_mandir}/man?/{%{clientbin}}%{alternative_major}.?.*;do echo $i|grep -v smbprint;done)
 #xclude %{_mandir}/man?/smbget*
-%{_mandir}/man5/smbgetrc3.5*
+%{_mandir}/man5/smbgetrc%{alternative_major}.5*
 %ifnarch alpha
 %(for i in /sbin/{%{client_sbin}}%{alternative_major};do echo $i;done)
 %attr(4755,root,root) /bin/mount.cifs%{alternative_major}
@@ -1803,6 +1825,31 @@
 %exclude %{_mandir}/man1/smbsh*.1*
 
 %changelog
+* Wed Sep 08 2004 Buchan Milne <bgmilne@linux-mandrake.com> 3.0.6-5mdk
+- patch for samba bug 1464
+- make release-depenent release tag more like security updates tags
+- sync smb.conf with drakwizard (which also fixes quoting of macros which
+  can have spaces)
+- add example admin share
+
+* Mon Aug 31 2004 Buchan Milne <bgmilne@linux-mandrake.com> 3.0.6-4mdk
+- Add Jerry's post-3.0.6 patches
+- fix bug 11088 
+
+* Fri Aug 27 2004 Buchan Milne <bgmilne@linux-mandrake.com>3.0.6-3mdk
+- patch from Urban Widmark via Robert Sim (anthill bug 1086) to be able
+  to diable unix extensions in smbmount (and via 'unix extensions' in smb.conf)
+- magic-devel only available on 9.2 and up
+- allow building for stable release on the chroots on the cluster
+- fix patch8
+- fix build on older releases
+
+* Fri Aug 20 2004 Buchan Milne <bgmilne@linux-mandrake.com> 3.0.6-2mdk
+- 3.0.6
+-drop P6 (merged), P7 (broken for now)
+-keep libsmbclient where it belongs (on x86 for now)
+-implement mandrake version-specific release number
+
 * Thu Aug 12 2004 Buchan Milne <bgmilne@linux-mandrake.com> 3.0.5-2mdk
 - 3.0.5
 - fix pid file location (#10666)
