Index: squid/helpers/basic_auth/LDAP/squid_ldap_auth.c
diff -c squid/helpers/basic_auth/LDAP/squid_ldap_auth.c:1.21.2.22 squid/helpers/basic_auth/LDAP/squid_ldap_auth.c:1.21.2.23
*** squid/helpers/basic_auth/LDAP/squid_ldap_auth.c:1.21.2.22	Thu Sep  1 16:47:19 2005
--- squid/helpers/basic_auth/LDAP/squid_ldap_auth.c	Sat Sep 10 18:53:23 2005
***************
*** 259,270 ****
      }
      if (use_tls) {
  #ifdef LDAP_OPT_X_TLS
!         if (version == LDAP_VERSION3 && ldap_start_tls_s(ld, NULL, NULL) != LDAP_SUCCESS) {
! 	    fprintf(stderr, "Could not Activate TLS connection\n");
! 	    exit(1);
! 	} else {
  	    fprintf(stderr, "TLS requires LDAP version 3\n");
  	    exit(1);
  	}
  #else
  	fprintf(stderr, "TLS not supported with your LDAP library\n");
--- 259,270 ----
      }
      if (use_tls) {
  #ifdef LDAP_OPT_X_TLS
!         if (version != LDAP_VERSION3) {
  	    fprintf(stderr, "TLS requires LDAP version 3\n");
  	    exit(1);
+ 	} else if (ldap_start_tls_s(ld, NULL, NULL) != LDAP_SUCCESS) {
+ 	    fprintf(stderr, "Could not Activate TLS connection\n");
+ 	    exit(1);
  	}
  #else
  	fprintf(stderr, "TLS not supported with your LDAP library\n");
Index: squid/helpers/external_acl/ldap_group/squid_ldap_group.c
diff -c squid/helpers/external_acl/ldap_group/squid_ldap_group.c:1.2.2.23 squid/helpers/external_acl/ldap_group/squid_ldap_group.c:1.2.2.24
*** squid/helpers/external_acl/ldap_group/squid_ldap_group.c:1.2.2.23	Tue Mar 22 15:54:27 2005
--- squid/helpers/external_acl/ldap_group/squid_ldap_group.c	Sat Sep 10 18:53:23 2005
***************
*** 499,512 ****
  		}
  		if (use_tls) {
  #ifdef LDAP_OPT_X_TLS
! 		    if (version == LDAP_VERSION3 && ldap_start_tls_s(ld, NULL, NULL) != LDAP_SUCCESS) {
  			fprintf(stderr, "Could not Activate TLS connection\n");
  			ldap_unbind(ld);
  			ld = NULL;
  			break;
- 		    } else {
- 			fprintf(stderr, "TLS requires LDAP version 3\n");
- 			exit(1);
  		    }
  #else
  		    fprintf(stderr, "TLS not supported with your LDAP library\n");
--- 499,512 ----
  		}
  		if (use_tls) {
  #ifdef LDAP_OPT_X_TLS
! 		    if (version != LDAP_VERSION3) {
! 			fprintf(stderr, "TLS requires LDAP version 3\n");
! 			exit(1);
! 		    } else if (ldap_start_tls_s(ld, NULL, NULL) != LDAP_SUCCESS) {
  			fprintf(stderr, "Could not Activate TLS connection\n");
  			ldap_unbind(ld);
  			ld = NULL;
  			break;
  		    }
  #else
  		    fprintf(stderr, "TLS not supported with your LDAP library\n");
