#!/bin/sh
PATH="/sbin:/usr/sbin:/bin:/usr/bin:$PATH"

# this runs slurpd under supervise

# don't run slurpd if we don't define replogfile
	if grep -Eq "^[[:space:]]*replica[[:space:]]+(host|uri)" /etc/openldap/slapd.conf; then

REPLOG=`grep -Eq "^[[:space:]]*replica[[:space:]]+(host|uri)" /etc/openldap/slapd.conf; echo $?`
if [ "$REPLOG" = "1" ]; then
  echo "Disabling slurpd because replica not found!"
  touch down
  svc -d /service/slurpd
  touch log/down
  svc -d /service/slurpd/log
  exit 0
fi

exec /usr/bin/setuidgid ldap /usr/sbin/slurpd -d
